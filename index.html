<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµí•™íŒ€ ë¬¸ì˜ ì±—ë´‡</title>
    
    <!-- 
    ============================================
    CSS (ìŠ¤íƒ€ì¼) ì„¹ì…˜
    ============================================
    - HTML ìš”ì†Œë“¤ì˜ ëª¨ì–‘, ìƒ‰ìƒ, í¬ê¸° ë“±ì„ ì •ì˜
    - <style> íƒœê·¸ ì•ˆì— ì‘ì„±
    -->
    <style>
        /* 
        * (ë³„í‘œ)ëŠ” "ëª¨ë“  ìš”ì†Œ"ë¥¼ ì˜ë¯¸
        box-sizing: border-boxëŠ” padding, borderë¥¼ widthì— í¬í•¨ì‹œí‚´
        â†’ ë ˆì´ì•„ì›ƒ ê³„ì‚°ì´ ì‰¬ì›Œì§
        */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /*
        body: í˜ì´ì§€ ì „ì²´ ë°°ê²½
        font-family: ê¸€ê¼´ (ì•ì—ì„œë¶€í„° ì‹œë„, ì—†ìœ¼ë©´ ë‹¤ìŒ ê¸€ê¼´)
        */
        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;  /* vh = viewport height, í™”ë©´ ë†’ì´ì˜ 100% */
            display: flex;
            justify-content: center;  /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
            padding: 20px;
        }

        /*
        ì±„íŒ… ì»¨í…Œì´ë„ˆ (ì „ì²´ ì±„íŒ…ì°½ì„ ê°ì‹¸ëŠ” ë°•ìŠ¤)
        max-width: ìµœëŒ€ ë„ˆë¹„ ì œí•œ
        width: 100%ì§€ë§Œ max-width ë•Œë¬¸ì— 800px ë„˜ì§€ ì•ŠìŒ
        */
        .chat-container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 16px;  /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);  /* ê·¸ë¦¼ì íš¨ê³¼ */
            display: flex;
            flex-direction: column;  /* ì„¸ë¡œ ë°©í–¥ ë°°ì¹˜ */
            height: 90vh;  /* í™”ë©´ ë†’ì´ì˜ 90% */
        }

        /* 
        ì±„íŒ…ì°½ í—¤ë” (ìƒë‹¨ ì œëª© ë¶€ë¶„)
        */
        .chat-header {
            padding: 20px;
            background: #2563eb;  /* íŒŒë€ìƒ‰ ë°°ê²½ */
            color: white;
            border-radius: 16px 16px 0 0;  /* ìœ„ìª½ë§Œ ë‘¥ê¸€ê²Œ */
            text-align: center;
        }

        .chat-header h1 {
            font-size: 1.25rem;  /* rem = root em, ê¸°ë³¸ ê¸€ê¼´ í¬ê¸° ê¸°ì¤€ */
            font-weight: 600;
        }

        .chat-header p {
            font-size: 0.875rem;
            opacity: 0.9;  /* ì•½ê°„ íˆ¬ëª…í•˜ê²Œ */
            margin-top: 4px;
        }

        /*
        ë©”ì‹œì§€ ì˜ì—­ (ëŒ€í™” ë‚´ìš©ì´ í‘œì‹œë˜ëŠ” ê³³)
        flex: 1 â†’ ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì°¨ì§€
        overflow-y: auto â†’ ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ ìƒì„±
        */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;  /* ë©”ì‹œì§€ ê°„ ê°„ê²© */
        }

        /*
        ê°œë³„ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
        */
        .message {
            max-width: 80%;  /* ë©”ì‹œì§€ ìµœëŒ€ ë„ˆë¹„ */
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.5;  /* ì¤„ ê°„ê²© */
            word-break: keep-all;  /* í•œê¸€ ë‹¨ì–´ ë‹¨ìœ„ë¡œ ì¤„ë°”ê¿ˆ */
        }

        /*
        ì‚¬ìš©ì ë©”ì‹œì§€ (ì˜¤ë¥¸ìª½ ì •ë ¬, íŒŒë€ ë°°ê²½)
        align-self: flex-end â†’ ì˜¤ë¥¸ìª½ ì •ë ¬
        */
        .message.user {
            align-self: flex-end;
            background: #2563eb;
            color: white;
        }

        /*
        ë´‡ ë©”ì‹œì§€ (ì™¼ìª½ ì •ë ¬, íšŒìƒ‰ ë°°ê²½)
        align-self: flex-start â†’ ì™¼ìª½ ì •ë ¬
        */
        .message.bot {
            align-self: flex-start;
            background: #e5e7eb;
            color: #1f2937;
        }

        /*
        ì‘ë‹µ íƒ€ì… í‘œì‹œ (direct, conditional ë“±)
        */
        .response-type {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            display: inline-block;
        }

        .response-type.direct {
            background: #dcfce7;  /* ì—°ë‘ìƒ‰ */
            color: #166534;
        }

        .response-type.conditional {
            background: #fef3c7;  /* ë…¸ë€ìƒ‰ */
            color: #92400e;
        }

        .response-type.human_handoff {
            background: #fee2e2;  /* ë¹¨ê°„ìƒ‰ */
            color: #991b1b;
        }

        /*
        ì¸ìš©ëœ ê·œì • í‘œì‹œ
        */
        .cited-regulations {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #d1d5db;
            font-size: 0.875rem;
        }

        .cited-regulations summary {
            cursor: pointer;  /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì†ê°€ë½ ëª¨ì–‘ */
            color: #6b7280;
        }

        .cited-regulations ul {
            margin-top: 8px;
            padding-left: 20px;
        }

        .cited-regulations li {
            margin: 4px 0;
            color: #4b5563;
        }

        /*
        ë¡œë”© í‘œì‹œ (ì  3ê°œ ì• ë‹ˆë©”ì´ì…˜)
        */
        .loading {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }

        .loading span {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;  /* ì›í˜• */
            animation: bounce 1.4s infinite;  /* ì• ë‹ˆë©”ì´ì…˜ ì ìš© */
        }

        /* 
        ê° ì ë§ˆë‹¤ ë‹¤ë¥¸ íƒ€ì´ë°ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜
        nth-child(n): në²ˆì§¸ ìš”ì†Œ ì„ íƒ
        */
        .loading span:nth-child(2) { animation-delay: 0.2s; }
        .loading span:nth-child(3) { animation-delay: 0.4s; }

        /*
        @keyframes: ì• ë‹ˆë©”ì´ì…˜ ì •ì˜
        0%, 100%: ì‹œì‘ê³¼ ë
        50%: ì¤‘ê°„
        */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /*
        ì…ë ¥ ì˜ì—­ (í•˜ë‹¨ ì…ë ¥ì°½ + ë²„íŠ¼)
        */
        .chat-input {
            padding: 16px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
        }

        /*
        í…ìŠ¤íŠ¸ ì…ë ¥ì°½
        flex: 1 â†’ ë²„íŠ¼ ì œì™¸í•œ ê³µê°„ ëª¨ë‘ ì°¨ì§€
        */
        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            outline: none;  /* í¬ì»¤ìŠ¤ ì‹œ ê¸°ë³¸ í…Œë‘ë¦¬ ì œê±° */
        }

        /* 
        input:focus â†’ ì…ë ¥ì°½ í´ë¦­í–ˆì„ ë•Œ 
        */
        .chat-input input:focus {
            border-color: #2563eb;
        }

        /*
        ì „ì†¡ ë²„íŠ¼
        */
        .chat-input button {
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;  /* ìƒ‰ìƒ ë³€í™” ë¶€ë“œëŸ½ê²Œ */
        }

        /*
        ë²„íŠ¼ì— ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ
        */
        .chat-input button:hover {
            background: #1d4ed8;
        }

        /*
        ë²„íŠ¼ ë¹„í™œì„±í™” ìƒíƒœ (ë¡œë”© ì¤‘)
        */
        .chat-input button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        /*
        ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
        */
        .error {
            background: #fee2e2 !important;  /* !important: ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ë³´ë‹¤ ìš°ì„  */
            color: #991b1b !important;
        }
    </style>
</head>
<body>
    <!-- 
    ============================================
    HTML (êµ¬ì¡°) ì„¹ì…˜
    ============================================
    - í˜ì´ì§€ì˜ ë¼ˆëŒ€ë¥¼ êµ¬ì„±
    - ê° ìš”ì†Œì— classë¥¼ ë¶™ì—¬ì„œ CSSë¡œ ìŠ¤íƒ€ì¼ ì ìš©
    -->
    
    <div class="chat-container">
        <!-- í—¤ë” -->
        <div class="chat-header">
            <h1>ğŸ“ êµí•™íŒ€ ë¬¸ì˜ ì±—ë´‡</h1>
            <p>íœ´í•™, ë³µí•™, ìˆ˜ê°•ì‹ ì²­ ë“± í•™ì‚¬ ê´€ë ¨ ì§ˆë¬¸ì— ë‹µë³€í•´ë“œë¦½ë‹ˆë‹¤</p>
        </div>
        
        <!-- ë©”ì‹œì§€ ì˜ì—­ (JavaScriptë¡œ ë‚´ìš© ì¶”ê°€ë¨) -->
        <div class="chat-messages" id="chatMessages">
            <!-- ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€ -->
            <div class="message bot">
                ì•ˆë…•í•˜ì„¸ìš”! êµí•™íŒ€ ë¬¸ì˜ ì±—ë´‡ì…ë‹ˆë‹¤. ğŸ™‹â€â™‚ï¸<br>
                í•™ì‚¬ ê´€ë ¨ ê¶ê¸ˆí•œ ì ì„ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
            </div>
        </div>
        
        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="chat-input">
            <!-- 
            id: JavaScriptì—ì„œ ì´ ìš”ì†Œë¥¼ ì°¾ê¸° ìœ„í•œ ê³ ìœ  ì‹ë³„ì
            placeholder: ì…ë ¥ ì „ íŒíŠ¸ í…ìŠ¤íŠ¸
            -->
            <input 
                type="text" 
                id="userInput" 
                placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
            >
            <button id="sendButton" onclick="sendMessage()">ì „ì†¡</button>
        </div>
    </div>

    <!-- 
    ============================================
    JavaScript (ë™ì‘) ì„¹ì…˜
    ============================================
    - ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì²˜ë¦¬
    - ì„œë²„ì™€ í†µì‹  (API í˜¸ì¶œ)
    - í™”ë©´ ì—…ë°ì´íŠ¸
    -->
    <script>
        // ============================================
        // 1. ì„¤ì •ê°’ (Configuration)
        // ============================================
        
        /*
        API ì„œë²„ ì£¼ì†Œ
        - ê°œë°œ í™˜ê²½: localhost (ë‚´ ì»´í“¨í„°)
        - ì‹¤ì œ ë°°í¬ ì‹œ: ì„œë²„ ì£¼ì†Œë¡œ ë³€ê²½ í•„ìš”
        
        run.pyì˜ settingsë¥¼ ë³´ë©´ ê¸°ë³¸ í¬íŠ¸ëŠ” 8000
        */
        const API_URL = 'http://localhost:8000';
        
        
        // ============================================
        // 2. DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        // ============================================
        
        /*
        document.getElementById(): HTMLì—ì„œ í•´ë‹¹ idë¥¼ ê°€ì§„ ìš”ì†Œë¥¼ ì°¾ìŒ
        - ì°¾ì€ ìš”ì†Œë¥¼ ë³€ìˆ˜ì— ì €ì¥í•´ë‘ë©´ ë‚˜ì¤‘ì— ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥
        
        DOM (Document Object Model)
        - HTML ë¬¸ì„œë¥¼ JavaScriptê°€ ë‹¤ë£° ìˆ˜ ìˆëŠ” ê°ì²´ í˜•íƒœë¡œ í‘œí˜„í•œ ê²ƒ
        */
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        
        
        // ============================================
        // 3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        // ============================================
        
        /*
        addEventListener(): íŠ¹ì • ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜ ë“±ë¡
        - 'keypress': í‚¤ë³´ë“œ í‚¤ë¥¼ ëˆŒë €ì„ ë•Œ
        - e.key === 'Enter': ëˆ„ë¥¸ í‚¤ê°€ Enterì¸ì§€ í™•ì¸
        
        ì´ë²¤íŠ¸(Event)ë€?
        - í´ë¦­, í‚¤ ì…ë ¥, ìŠ¤í¬ë¡¤ ë“± ì‚¬ìš©ì í–‰ë™
        - ë¸Œë¼ìš°ì €ê°€ ì´ë²¤íŠ¸ ë°œìƒì„ ê°ì§€í•˜ê³  ë“±ë¡ëœ í•¨ìˆ˜ë¥¼ ì‹¤í–‰
        */
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();  // Enter ëˆ„ë¥´ë©´ ë©”ì‹œì§€ ì „ì†¡
            }
        });
        
        
        // ============================================
        // 4. ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜ (ë©”ì¸ ë¡œì§)
        // ============================================
        
        /*
        async function: ë¹„ë™ê¸° í•¨ìˆ˜
        - ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ì‘ì—… ê°€ëŠ¥
        - await í‚¤ì›Œë“œ ì‚¬ìš© ê°€ëŠ¥
        
        ë™ê¸° vs ë¹„ë™ê¸°:
        - ë™ê¸°: ì• ì‘ì—…ì´ ëë‚˜ì•¼ ë‹¤ìŒ ì‘ì—… ì‹œì‘ (ì¤„ ì„œê¸°)
        - ë¹„ë™ê¸°: ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ì‘ì—… ê°€ëŠ¥ (ì§„ë™ë²¨)
        */
        async function sendMessage() {
            // --- 4-1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸° ---
            /*
            .value: input ìš”ì†Œì— ì…ë ¥ëœ í…ìŠ¤íŠ¸
            .trim(): ì•ë’¤ ê³µë°± ì œê±° ("  ì•ˆë…•  " â†’ "ì•ˆë…•")
            */
            const message = userInput.value.trim();
            
            // ë¹ˆ ë©”ì‹œì§€ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
            if (!message) return;
            
            // --- 4-2. ì…ë ¥ì°½ ì´ˆê¸°í™” ë° ë²„íŠ¼ ë¹„í™œì„±í™” ---
            userInput.value = '';  // ì…ë ¥ì°½ ë¹„ìš°ê¸°
            sendButton.disabled = true;  // ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ ì „ì†¡ ë°©ì§€)
            
            // --- 4-3. ì‚¬ìš©ì ë©”ì‹œì§€ í™”ë©´ì— í‘œì‹œ ---
            addMessage(message, 'user');
            
            // --- 4-4. ë¡œë”© í‘œì‹œ ---
            const loadingElement = addLoading();
            
            // --- 4-5. ì„œë²„ì— ìš”ì²­ ë³´ë‚´ê¸° ---
            try {
                /*
                fetch(): ì„œë²„ì— HTTP ìš”ì²­ì„ ë³´ë‚´ëŠ” í•¨ìˆ˜ (ë¸Œë¼ìš°ì € ë‚´ì¥)
                - ì²« ë²ˆì§¸ ì¸ì: URL (ì–´ë””ë¡œ?)
                - ë‘ ë²ˆì§¸ ì¸ì: ì˜µì…˜ (ì–´ë–»ê²Œ?)
                
                await: ì‘ë‹µì´ ì˜¬ ë•Œê¹Œì§€ ì—¬ê¸°ì„œ ê¸°ë‹¤ë¦¼
                - í•˜ì§€ë§Œ ë¸Œë¼ìš°ì € ì „ì²´ê°€ ë©ˆì¶”ì§€ëŠ” ì•ŠìŒ (ë¹„ë™ê¸°)
                */
                const response = await fetch(`${API_URL}/query`, {
                    method: 'POST',  // HTTP ë©”ì„œë“œ (ë°ì´í„° ë³´ë‚´ê¸°)
                    headers: {
                        'Content-Type': 'application/json',  // "JSON í˜•ì‹ìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤"
                    },
                    /*
                    body: ì‹¤ì œ ë³´ë‚´ëŠ” ë°ì´í„°
                    
                    JSON.stringify(): JavaScript ê°ì²´ â†’ JSON ë¬¸ìì—´ ë³€í™˜
                    { question: "íœ´í•™ ì‹ ì²­" }  â†’  '{"question": "íœ´í•™ ì‹ ì²­"}'
                    
                    ì™œ ë¬¸ìì—´ë¡œ ë°”ê¾¸ë‚˜ìš”?
                    - HTTPë¡œëŠ” í…ìŠ¤íŠ¸(ë¬¸ìì—´)ë§Œ ì „ì†¡ ê°€ëŠ¥
                    - ê°ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë³´ë‚¼ ìˆ˜ ì—†ìŒ
                    */
                    body: JSON.stringify({ question: message }),
                });
                
                // --- 4-6. ì‘ë‹µ í™•ì¸ ---
                /*
                response.ok: HTTP ìƒíƒœ ì½”ë“œê°€ 200~299ë©´ true
                - 200: ì„±ê³µ
                - 404: í˜ì´ì§€ ì—†ìŒ
                - 500: ì„œë²„ ì—ëŸ¬
                */
                if (!response.ok) {
                    throw new Error('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
                /*
                response.json(): JSON ë¬¸ìì—´ â†’ JavaScript ê°ì²´ ë³€í™˜
                '{"answer": "íœ´í•™ì€..."}' â†’ { answer: "íœ´í•™ì€..." }
                
                ì„œë²„ì˜ ì‘ë‹µ í˜•ì‹ (FastAPIì˜ QueryResponse):
                {
                    "answer": "íœ´í•™ ì‹ ì²­ ë°©ë²•ì€...",
                    "response_type": "direct",
                    "cited_regulations": ["í•™ì¹™ ì œ30ì¡°", "íœ´í•™ê·œì • ì œ5ì¡°"]
                }
                */
                const data = await response.json();
                
                // --- 4-7. ë¡œë”© ì œê±° í›„ ë´‡ ì‘ë‹µ í‘œì‹œ ---
                loadingElement.remove();  // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì œê±°
                addBotMessage(data);  // ë´‡ ì‘ë‹µ í™”ë©´ì— ì¶”ê°€
                
            } catch (error) {
                /*
                try-catch: ì—ëŸ¬ ì²˜ë¦¬ (ì˜ˆì™¸ ì²˜ë¦¬)
                - try ë¸”ë¡ ì•ˆì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ catch ë¸”ë¡ ì‹¤í–‰
                - ì—ëŸ¬ê°€ ë‚˜ë„ í”„ë¡œê·¸ë¨ì´ ë©ˆì¶”ì§€ ì•ŠìŒ
                
                ì–¸ì œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë‚˜ìš”?
                - ì„œë²„ê°€ êº¼ì ¸ìˆì„ ë•Œ
                - ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ëŠê²¼ì„ ë•Œ
                - ì„œë²„ì—ì„œ 500 ì—ëŸ¬ë¥¼ ë³´ë‚¼ ë•Œ
                */
                console.error('Error:', error);  // ê°œë°œì ë„êµ¬ ì½˜ì†”ì— ì¶œë ¥
                loadingElement.remove();
                addMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'bot', true);
            } finally {
                /*
                finally: ì„±ê³µ/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰
                - ì •ë¦¬(cleanup) ì‘ì—…ì— ì‚¬ìš©
                */
                sendButton.disabled = false;  // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                userInput.focus();  // ì…ë ¥ì°½ì— ì»¤ì„œ ì´ë™
            }
        }
        
        
        // ============================================
        // 5. í™”ë©´ì— ë©”ì‹œì§€ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ë“¤
        // ============================================
        
        /**
         * ì¼ë°˜ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶”ê°€
         * 
         * @param {string} content - ë©”ì‹œì§€ ë‚´ìš©
         * @param {string} type - 'user' ë˜ëŠ” 'bot'
         * @param {boolean} isError - ì—ëŸ¬ ë©”ì‹œì§€ ì—¬ë¶€
         * @returns {HTMLElement} ìƒì„±ëœ ë©”ì‹œì§€ ìš”ì†Œ
         */
        function addMessage(content, type, isError = false) {
            /*
            document.createElement(): ìƒˆ HTML ìš”ì†Œë¥¼ ë©”ëª¨ë¦¬ì— ìƒì„±
            - ì•„ì§ í™”ë©´ì—ëŠ” ì•ˆ ë³´ì„
            - appendChild()ë¡œ ì¶”ê°€í•´ì•¼ í™”ë©´ì— í‘œì‹œ
            */
            const messageDiv = document.createElement('div');
            
            /*
            classList: ìš”ì†Œì˜ CSS í´ë˜ìŠ¤ ëª©ë¡
            .add(): í´ë˜ìŠ¤ ì¶”ê°€
            
            <div class="message user"> ì´ëŸ° ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì§
            */
            messageDiv.classList.add('message', type);
            if (isError) messageDiv.classList.add('error');
            
            /*
            textContent vs innerHTML
            - textContent: í…ìŠ¤íŠ¸ë§Œ (HTML íƒœê·¸ê°€ ê·¸ëŒ€ë¡œ ë³´ì„)
            - innerHTML: HTMLë¡œ í•´ì„ (íƒœê·¸ê°€ ì ìš©ë¨)
            
            ë³´ì•ˆ: ì‚¬ìš©ì ì…ë ¥ì€ textContent ì‚¬ìš© (XSS ê³µê²© ë°©ì§€)
            */
            messageDiv.textContent = content;
            
            /*
            appendChild(): ìì‹ ìš”ì†Œë¡œ ì¶”ê°€
            chatMessages ìš”ì†Œ ì•ˆì˜ ë§¨ ëì— ì¶”ê°€ë¨
            
            Before: <div id="chatMessages">ê¸°ì¡´ ë©”ì‹œì§€ë“¤</div>
            After:  <div id="chatMessages">ê¸°ì¡´ ë©”ì‹œì§€ë“¤<div>ìƒˆ ë©”ì‹œì§€</div></div>
            */
            chatMessages.appendChild(messageDiv);
            
            /*
            ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ ì´ë™
            - scrollTop: í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜
            - scrollHeight: ì „ì²´ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë†’ì´
            - scrollTop = scrollHeight â†’ ë§¨ ì•„ë˜ë¡œ
            */
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return messageDiv;  // ë‚˜ì¤‘ì— ì´ ìš”ì†Œë¥¼ ì¡°ì‘í•˜ê¸° ìœ„í•´ ë°˜í™˜
        }
        
        /**
         * ë´‡ ì‘ë‹µì„ í™”ë©´ì— ì¶”ê°€ (ì‘ë‹µ íƒ€ì…, ê·œì • ì¸ìš© í¬í•¨)
         * 
         * @param {object} data - ì„œë²„ ì‘ë‹µ ê°ì²´
         */
        function addBotMessage(data) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', 'bot');
            
            /*
            innerHTML: HTML ë¬¸ìì—´ë¡œ ë‚´ìš© ì„¤ì •
            - íƒœê·¸ ì‚¬ìš© ê°€ëŠ¥ (<span>, <br> ë“±)
            - ì£¼ì˜: ì‚¬ìš©ì ì…ë ¥ì„ ë„£ìœ¼ë©´ XSS ê³µê²© ìœ„í—˜!
                    ì—¬ê¸°ì„œëŠ” ì„œë²„ ì‘ë‹µë§Œ ë„£ìœ¼ë¯€ë¡œ ê´œì°®ìŒ
            */
            let html = '';
            
            // ì‘ë‹µ íƒ€ì… ë°°ì§€ ì¶”ê°€
            if (data.response_type) {
                /*
                ê°ì²´ ë¦¬í„°ëŸ´: í‚¤-ê°’ ìŒìœ¼ë¡œ ë°ì´í„° ì €ì¥
                typeLabels['direct'] â†’ 'âœ… ì§ì ‘ ë‹µë³€'
                */
                const typeLabels = {
                    'direct': 'âœ… ì§ì ‘ ë‹µë³€',
                    'conditional': 'âš ï¸ ì¡°ê±´ë¶€ ë‹µë³€',
                    'human_handoff': 'ğŸ“ ìƒë‹´ í•„ìš”'
                };
                
                /*
                í…œí”Œë¦¿ ë¦¬í„°ëŸ´ (ë°±í‹± ``)
                - ì—¬ëŸ¬ ì¤„ ë¬¸ìì—´ ê°€ëŠ¥
                - ${ë³€ìˆ˜}ë¡œ ë³€ìˆ˜ ì‚½ì…
                
                || : OR ì—°ì‚°ì (ì•ì´ falsyë©´ ë’¤ ì‚¬ìš©)
                - typeLabels[data.response_type]ê°€ ì—†ìœ¼ë©´ data.response_type ê·¸ëŒ€ë¡œ í‘œì‹œ
                */
                html += `<span class="response-type ${data.response_type}">
                    ${typeLabels[data.response_type] || data.response_type}
                </span><br>`;
            }
            
            // ë‹µë³€ ë‚´ìš© ì¶”ê°€
            /*
            || : OR ì—°ì‚°ìë¡œ ê¸°ë³¸ê°’ ì„¤ì •
            data.answerê°€ ì—†ìœ¼ë©´ â†’ data.message ì‹œë„ â†’ ê·¸ê²ƒë„ ì—†ìœ¼ë©´ ê¸°ë³¸ ë¬¸êµ¬
            */
            html += data.answer || data.message || 'ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
            
            // ì¸ìš©ëœ ê·œì • ì¶”ê°€
            /*
            ì¡°ê±´ ì²´í¬:
            1. data.cited_regulationsê°€ ì¡´ì¬í•˜ëŠ”ì§€
            2. ë°°ì—´ì¸ì§€ (Array.isArray)
            3. ë¹„ì–´ìˆì§€ ì•Šì€ì§€ (.length > 0)
            */
            if (data.cited_regulations && 
                Array.isArray(data.cited_regulations) && 
                data.cited_regulations.length > 0) {
                
                /*
                <details>ì™€ <summary>: ì ‘ì—ˆë‹¤ í¼ì¹  ìˆ˜ ìˆëŠ” UI
                - summary: í•­ìƒ ë³´ì´ëŠ” ì œëª©
                - ë‚˜ë¨¸ì§€: í´ë¦­í•˜ë©´ í¼ì³ì§
                */
                html += `
                    <div class="cited-regulations">
                        <details>
                            <summary>ğŸ“š ì°¸ê³  ê·œì • (${data.cited_regulations.length}ê°œ)</summary>
                            <ul>
                                ${data.cited_regulations.map(reg => `<li>${reg}</li>`).join('')}
                            </ul>
                        </details>
                    </div>
                `;
                /*
                .map(): ë°°ì—´ì˜ ê° ìš”ì†Œë¥¼ ë³€í™˜í•˜ì—¬ ìƒˆ ë°°ì—´ ìƒì„±
                ['í•™ì¹™ ì œ30ì¡°', 'íœ´í•™ê·œì •'] 
                    â†’ ['<li>í•™ì¹™ ì œ30ì¡°</li>', '<li>íœ´í•™ê·œì •</li>']
                
                .join(''): ë°°ì—´ ìš”ì†Œë“¤ì„ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ í•©ì¹¨
                ['<li>í•™ì¹™</li>', '<li>íœ´í•™</li>']
                    â†’ '<li>í•™ì¹™</li><li>íœ´í•™</li>'
                */
            }
            
            messageDiv.innerHTML = html;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        /**
         * ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
         * @returns {HTMLElement} ë¡œë”© ìš”ì†Œ (ë‚˜ì¤‘ì— ì œê±°í•˜ê¸° ìœ„í•´)
         */
        function addLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.classList.add('message', 'bot', 'loading');
            
            // ì  3ê°œ ìƒì„± (CSS ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ì›€ì§ì„)
            loadingDiv.innerHTML = `
                <span></span>
                <span></span>
                <span></span>
            `;
            
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return loadingDiv;  // ì‘ë‹µ ì˜¤ë©´ ì´ ìš”ì†Œë¥¼ ì§€ì›Œì•¼ í•˜ë¯€ë¡œ ë°˜í™˜
        }
        
        
        // ============================================
        // 6. ì„œë²„ ìƒíƒœ í™•ì¸
        // ============================================
        
        /**
         * í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸
         * - ì„œë²„ê°€ êº¼ì ¸ìˆìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
         */
        async function checkServerStatus() {
            try {
                /*
                /health ì—”ë“œí¬ì¸íŠ¸: ì„œë²„ ìƒíƒœ í™•ì¸ìš©
                - ì„œë²„ê°€ ì •ìƒì´ë©´ 200 OK ì‘ë‹µ
                - FastAPIì˜ @app.get("/health")ì— í•´ë‹¹
                */
                const response = await fetch(`${API_URL}/health`);
                if (response.ok) {
                    console.log('âœ… ì„œë²„ ì—°ê²° ì„±ê³µ');
                }
            } catch (error) {
                /*
                ì„œë²„ ì—°ê²° ì‹¤íŒ¨ ì‹œ
                - console.warn: ê²½ê³  ë©”ì‹œì§€ (ë…¸ë€ìƒ‰)
                - console.error: ì—ëŸ¬ ë©”ì‹œì§€ (ë¹¨ê°„ìƒ‰)
                */
                console.warn('âš ï¸ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error.message);
                addMessage(
                    'âš ï¸ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.\n' +
                    'ì‹¤í–‰ ëª…ë ¹ì–´: python run.py',
                    'bot',
                    true
                );
            }
        }
        
        /*
        í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì„œë²„ ìƒíƒœ í™•ì¸ ì‹¤í–‰
        - ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì ì— ë°”ë¡œ í˜¸ì¶œ
        */
        checkServerStatus();
    </script>
</body>
</html>
